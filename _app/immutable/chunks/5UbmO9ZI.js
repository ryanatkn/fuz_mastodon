import{ae as a,K as r,a4 as o,L as u,af as f}from"./Bz9QDf6u.js";import{E as g}from"./C7lgd2ss.js";import{f as v,d as E,j as d}from"./BJQqDxz4.js";import{p as k}from"./BnHu1Y6G.js";const B=(i=0)=>new Promise(e=>setTimeout(e,i)),T=i=>i!=null&&typeof i.then=="function";class x{#e=a(0);get width(){return r(this.#e)}set width(e){o(this.#e,e,!0)}#t=a(0);get height(){return r(this.#t)}set height(e){o(this.#t,e,!0)}}const N=(i,e=k.url.origin)=>{const t=v(e,"/");if(i===e||i===t)return"/";const s=E(i,t);return s===i?i:"/"+s};class O{is_menu=!1;menu;run;disabled;#e=a(!1);get selected(){return r(this.#e)}set selected(e){o(this.#e,e,!0)}#t=a(!1);get pending(){return r(this.#t)}set pending(e){o(this.#t,e,!0)}#s=a(null);get error_message(){return r(this.#s)}set error_message(e){o(this.#s,e,!0)}#n=a(null);get promise(){return r(this.#n)}set promise(e){o(this.#n,e)}constructor(e,t,s=()=>!1){this.menu=e,this.run=t,this.disabled=s}}class S{is_menu=!0;menu;depth;#e=a(!1);get selected(){return r(this.#e)}set selected(e){o(this.#e,e,!0)}#t=a([]);get items(){return r(this.#t)}set items(e){o(this.#t,e)}constructor(e,t){this.menu=e,this.depth=t}}class A{is_menu=!0;menu=null;depth=1;#e=a([]);get items(){return r(this.#e)}set items(e){o(this.#e,e)}}class I{layout;has_custom_layout;#e=a(!1);get opened(){return r(this.#e)}set opened(e){o(this.#e,e,!0)}#t=a(0);get x(){return r(this.#t)}set x(e){o(this.#t,e,!0)}#s=a(0);get y(){return r(this.#s)}set y(e){o(this.#s,e,!0)}#n=a([]);get params(){return r(this.#n)}set params(e){o(this.#n,e)}#i=a();get error(){return r(this.#i)}set error(e){o(this.#i,e,!0)}root_menu=new A;#r=a([]);get selections(){return r(this.#r)}set selections(e){o(this.#r,e)}#o=u(()=>this.selections.length>1);get can_collapse(){return r(this.#o)}set can_collapse(e){o(this.#o,e)}#a=u(()=>{const e=this.selections.at(-1);return!!e?.is_menu&&e.items.length>0});get can_expand(){return r(this.#a)}set can_expand(e){o(this.#a,e)}#c=u(()=>(this.selections.at(-1)?.menu??this.root_menu).items.length>1);get can_select_next(){return r(this.#c)}set can_select_next(e){o(this.#c,e)}#u=u(()=>(this.selections.at(-1)?.menu??this.root_menu).items.length>1);get can_select_previous(){return r(this.#u)}set can_select_previous(e){o(this.#u,e)}#l=u(()=>{const e=this.selections.at(-1);return e?e.is_menu?e.items.length>0:!e.disabled():!1});get can_activate(){return r(this.#l)}set can_activate(e){o(this.#l,e)}constructor(e=g){const{layout:t}=e;this.has_custom_layout=!!t,this.layout=t??new x}open(e,t,s){this.selections=[],this.opened=!0,this.x=t,this.y=s,this.params=e}close(){this.opened&&(this.reset_items(this.root_menu.items),this.opened=!1)}reset_items(e){for(const t of e)t.is_menu?this.reset_items(t.items):(t.promise=null,t.pending=!1,t.error_message=null)}activate(e){if(e.is_menu)this.expand_selected();else{if(e.disabled())return!1;let t;try{t=e.run()()}catch(s){const n=typeof s?.message=="string"?s.message:void 0;e.error_message=n??"unknown error",this.error=n}if(T(t)){e.pending=!0,e.error_message=null;const s=e.promise=t.then(n=>{if(s===e.promise){if(typeof n?.ok=="boolean")if(n.ok)n.close!==!1&&this.close();else{const c=typeof n.message=="string"?n.message:void 0;e.error_message=c??"unknown error",this.error=c}else this.close();return n}},n=>{if(s!==e.promise)return;const c=typeof n?.message=="string"?n.message:void 0;e.error_message=c??"unknown error",this.error=c}).finally(()=>{s===e.promise&&(e.pending=!1,e.promise=null)});return e.promise}if(typeof t?.ok=="boolean")if(t.ok)t.close!==!1&&this.close();else{const s=typeof t.message=="string"?t.message:void 0;e.error_message=s??"unknown error",this.error=s}else this.close()}return!0}activate_selected(){const e=this.selections.at(-1);if(e)return this.activate(e);this.select_first()}select(e){if(this.selections.at(-1)===e)return;for(const n of this.selections)n.selected=!1;const t=[];let s=e;do s.selected=!0,t.unshift(s);while((s=s.menu)&&s.menu);this.selections=t}collapse_selected(){if(!this.can_collapse)return;const e=this.selections.at(-1);e.selected=!1,this.selections=this.selections.slice(0,-1)}expand_selected(){if(!this.can_expand)return;const e=this.selections.at(-1);if(!e?.is_menu||!e.items.length)return;const t=e.items[0];t.selected=!0,this.selections=[...this.selections,t]}select_next(){if(!this.selections.length){this.select_first();return}const e=this.selections.at(-1),t=e.menu.items.indexOf(e);this.select(e.menu.items[t===e.menu.items.length-1?0:t+1])}select_previous(){if(!this.selections.length){this.select_last();return}const e=this.selections.at(-1),t=e.menu.items.indexOf(e);this.select(e.menu.items[t===0?e.menu.items.length-1:t-1])}select_first(){const e=this.selections.at(-1)?.menu??this.root_menu;e.items.length&&this.select(e.items[0])}select_last(){const{items:e}=this.selections.at(-1)?.menu??this.root_menu;this.select(e.at(-1))}add_entry(e,t=()=>!1){const s=m.get_maybe()??this.root_menu,n=new O(s,e,t);return s.items=[...s.items,n],f(()=>{s.items=[]}),n}add_submenu(){const e=m.get_maybe()??this.root_menu,t=new S(e,e.depth+1);return e.items=[...e.items,t],m.set(t),f(()=>{e.items=[]}),t}}const h="contextmenu",M=`a,[data-${h}]`,_=new Map;let C=0;const K=i=>e=>{if(i==null)return;let t=e.dataset[h];return t||(t=C+++"",e.dataset[h]=t),_.set(t,i),()=>{_.delete(t)}},D=17,j=(i,e,t,s,n)=>{const{link_enabled:c=!0,text_enabled:y=!0,separator_enabled:w=!0,vibrate:b=!0}=n??g,p=U(i)?.filter(l=>typeof l=="function"||(l.snippet!=="link"||c)&&(l.snippet!=="text"||y)&&(l.snippet!=="separator"||w));return p?.length?(s.open(p,e,t),b&&navigator.vibrate&&navigator.vibrate(D),!0):!1},U=i=>{let e=null,t=i,s,n;for(;t=t?.closest(M);){if(s=t.dataset[h]){if(e??=[],n=_.get(s),n===void 0)continue;Array.isArray(n)?(e??=[]).push(...n):(e??=[]).push(n)}t.tagName==="A"&&(e??=[]).push({snippet:"link",props:{href:N(t.href)}}),t=t.parentElement}if(e){const c=window.getSelection()?.toString();c&&e.unshift({snippet:"text",props:{content:"copy text",icon:"ðŸ“‹",run:async()=>{await navigator.clipboard.writeText(c)}}})}return e},q=d(),m=d(),J=d(()=>new x);export{I as C,q as a,J as b,K as c,j as d,B as w};
