import{ae as a,N as i,Y as r,O as u,af as p}from"./D5BSqs4d.js";import{E as g}from"./C7lgd2ss.js";import{i as d,j as v}from"./Cpc5zlgo.js";const R=(o=0)=>new Promise(e=>setTimeout(e,o)),E=o=>o&&typeof o.then=="function";class x{#e=a(0);get width(){return i(this.#e)}set width(e){r(this.#e,e,!0)}#t=a(0);get height(){return i(this.#t)}set height(e){r(this.#t,e,!0)}}class k{is_menu=!1;menu;run;disabled;#e=a(!1);get selected(){return i(this.#e)}set selected(e){r(this.#e,e,!0)}#t=a(!1);get pending(){return i(this.#t)}set pending(e){r(this.#t,e,!0)}#s=a(null);get error_message(){return i(this.#s)}set error_message(e){r(this.#s,e,!0)}#n=a(null);get promise(){return i(this.#n)}set promise(e){r(this.#n,e)}constructor(e,t,s=()=>!1){this.menu=e,this.run=t,this.disabled=s}}class T{is_menu=!0;menu;depth;#e=a(!1);get selected(){return i(this.#e)}set selected(e){r(this.#e,e,!0)}#t=a([]);get items(){return i(this.#t)}set items(e){r(this.#t,e)}constructor(e,t){this.menu=e,this.depth=t}}class N{is_menu=!0;menu=null;depth=1;#e=a([]);get items(){return i(this.#e)}set items(e){r(this.#e,e)}}class Y{layout;has_custom_layout;#e=a(!1);get opened(){return i(this.#e)}set opened(e){r(this.#e,e,!0)}#t=a(0);get x(){return i(this.#t)}set x(e){r(this.#t,e,!0)}#s=a(0);get y(){return i(this.#s)}set y(e){r(this.#s,e,!0)}#n=a([]);get params(){return i(this.#n)}set params(e){r(this.#n,e)}#i=a();get error(){return i(this.#i)}set error(e){r(this.#i,e,!0)}root_menu=new N;#r=a([]);get selections(){return i(this.#r)}set selections(e){r(this.#r,e)}#o=u(()=>this.selections.length>1);get can_collapse(){return i(this.#o)}set can_collapse(e){r(this.#o,e)}#a=u(()=>{const e=this.selections.at(-1);return!!e?.is_menu&&e.items.length>0});get can_expand(){return i(this.#a)}set can_expand(e){r(this.#a,e)}#c=u(()=>(this.selections.at(-1)?.menu??this.root_menu).items.length>1);get can_select_next(){return i(this.#c)}set can_select_next(e){r(this.#c,e)}#u=u(()=>(this.selections.at(-1)?.menu??this.root_menu).items.length>1);get can_select_previous(){return i(this.#u)}set can_select_previous(e){r(this.#u,e)}#l=u(()=>{const e=this.selections.at(-1);return e?e.is_menu?e.items.length>0:!e.disabled():!1});get can_activate(){return i(this.#l)}set can_activate(e){r(this.#l,e)}constructor(e=g){const{layout:t}=e;this.has_custom_layout=!!t,this.layout=t??new x}open(e,t,s){this.selections=[],this.opened=!0,this.x=t,this.y=s,this.params=e}close(){this.opened&&(this.reset_items(this.root_menu.items),this.opened=!1)}reset_items(e){for(const t of e)t.is_menu?this.reset_items(t.items):(t.promise=null,t.pending=!1,t.error_message=null)}activate(e){if(e.is_menu)this.expand_selected();else{if(e.disabled())return!1;let t;try{t=e.run()()}catch(s){const n=typeof s?.message=="string"?s.message:void 0;e.error_message=n??"unknown error",this.error=n}if(E(t)){e.pending=!0,e.error_message=null;const s=e.promise=t.then(n=>{if(s===e.promise){if(typeof n?.ok=="boolean")if(n.ok)n.close!==!1&&this.close();else{const c=typeof n.message=="string"?n.message:void 0;e.error_message=c??"unknown error",this.error=c}else this.close();return n}},n=>{if(s!==e.promise)return;const c=typeof n?.message=="string"?n.message:void 0;e.error_message=c??"unknown error",this.error=c}).finally(()=>{s===e.promise&&(e.pending=!1,e.promise=null)});return e.promise}if(typeof t?.ok=="boolean")if(t.ok)t.close!==!1&&this.close();else{const s=typeof t.message=="string"?t.message:void 0;e.error_message=s??"unknown error",this.error=s}else this.close()}return!0}activate_selected(){const e=this.selections.at(-1);if(e)return this.activate(e);this.select_first()}select(e){if(this.selections.at(-1)===e)return;for(const n of this.selections)n.selected=!1;const t=[];let s=e;do s.selected=!0,t.unshift(s);while((s=s.menu)&&s.menu);this.selections=t}collapse_selected(){if(!this.can_collapse)return;const e=this.selections.at(-1);e.selected=!1,this.selections=this.selections.slice(0,-1)}expand_selected(){if(!this.can_expand)return;const e=this.selections.at(-1);if(!e?.is_menu||!e.items.length)return;const t=e.items[0];t.selected=!0,this.selections=[...this.selections,t]}select_next(){if(!this.selections.length){this.select_first();return}const e=this.selections.at(-1),t=e.menu.items.indexOf(e);this.select(e.menu.items[t===e.menu.items.length-1?0:t+1])}select_previous(){if(!this.selections.length){this.select_last();return}const e=this.selections.at(-1),t=e.menu.items.indexOf(e);this.select(e.menu.items[t===0?e.menu.items.length-1:t-1])}select_first(){const e=this.selections.at(-1)?.menu??this.root_menu;e.items.length&&this.select(e.items[0])}select_last(){const{items:e}=this.selections.at(-1)?.menu??this.root_menu;this.select(e.at(-1))}add_entry(e,t=()=>!1){const s=m.get_maybe()??this.root_menu,n=new k(s,e,t);return s.items=[...s.items,n],p(()=>{s.items=[]}),n}add_submenu(){const e=m.get_maybe()??this.root_menu,t=new T(e,e.depth+1);return e.items=[...e.items,t],m.set(t),p(()=>{e.items=[]}),t}}const h="contextmenu",O=`a,[data-${h}]`,_=new Map;let S=0;const P=o=>e=>{if(o==null)return;let t=e.dataset[h];return t||(t=S+++"",e.dataset[h]=t),_.set(t,o),()=>{_.delete(t)}},A=17,X=(o,e,t,s,n)=>{const{link_enabled:c=!0,text_enabled:y=!0,separator_enabled:w=!0,vibrate:b=!0}=n??g,f=M(o)?.filter(l=>typeof l=="function"||(l.snippet!=="link"||c)&&(l.snippet!=="text"||y)&&(l.snippet!=="separator"||w));return f?.length?(s.open(f,e,t),b&&navigator.vibrate&&navigator.vibrate(A),!0):!1},M=o=>{let e=null,t=o,s,n;for(;t=t?.closest(O);){if(s=t.dataset[h]){if(e??=[],n=_.get(s),n===void 0)continue;Array.isArray(n)?(e??=[]).push(...n):(e??=[]).push(n)}t.tagName==="A"&&(e??=[]).push({snippet:"link",props:{href:v(t.href)}}),t=t.parentElement}if(e){const c=window.getSelection()?.toString();c&&e.unshift({snippet:"text",props:{content:"copy text",icon:"ðŸ“‹",run:async()=>{await navigator.clipboard.writeText(c)}}})}return e},B=d(),m=d(),I=d(()=>new x);export{Y as C,B as a,I as b,P as c,X as d,R as w};
